---
config:
  theme: default
---
erDiagram
    EDIFICIO {
      int id_edificio PK
      varchar nombre
      text descripción
      float latitud
      float longitud
      int numero_plantas
      int capacidad
      float superficie_total
    }
    PLANTA {
      int id_planta PK
      float superficie
      int numero_areas
      int id_edificio FK
    }
    AREA {
      int id_area PK
      varchar nombre
      text descripcion
      float superficie
      int capacidad
      boolean salida_segura
      boolean baliza
      int id_planta FK
      int id_tipo_area FK
    }
    TIPO_AREA {
      int id_tipo_area PK
      varchar nombre
      text descripción
    }
    ADYACENCIA {
      int id_conexion PK
      varchar nombre
      text descripcion
      float distancia
      int capacidad_flujo
      float tiempo_estimado
      boolean bidireccional
      boolean baliza
      int id_area_origen FK
      int id_area_destino FK
      int id_conexion FK
    }
    TIPO_ADYACENCIA {
      int id_adyacencia PK
      varchar tipo
      text descripcion
    }
    SEGURIDAD_RED {
      int id_seguridad_red PK
      int id_conexion FK
      int id_area FK      
      float valor_seguridad
      boolean seguro
    }
    BALIZAS {
      int id_baliza PK
      varchar nombre
      text descripción
      int id_ambiente FK
    }
    SENSOR {
      int id_sensor PK 
      varchar nombre
      text descripcion
    }
    VARIABLE {
      int id_variable PK
      varchar nombre
      text descripción
      varchar unidad
    }
    BALIZA_SENSOR {
      int id PK
      int id_baliza FK
      int id_sensor FK 
      text descripción
    }
    SENSOR_VARIABLE {
      int id PK
      int id_sensor FK
      int id_variable FK
      text descripción
    }
    LECTURA_BALIZA_AREAS {
      int id_lectura_area PK
      timestamp datatime
      int id_area FK
      int id_baliza FK
      int id_sensor FK
      int id_variable FK
    }
    LECTURA_BALIZA_ADYACENCIAS {
      int id_lectura_adyacencia PK
      timestamp datatime
      int id_adyacencia FK 
      int id_baliza FK
      int id_sensor FK
      int id_variable FK
    }
    HISTORICO_LECTURAS {
      int id PK
      timestamp datatime
      int id_lectura_adyacencia FK
      int id_lectura_area FK
    }
    SEGURIDAD_RED {
      int seguridad PK
      timestamp datetime 
      int id_lectura_area FK
      int id_lectura_adyacencia FK
      int id_evento FK
      float seguridad
      boolean seguro
    }
    HISTORICO_SEGURIDAD {
      int id PK
      timestamp datatime
      int id_seguridad FK
    }
    TIPO_EVENTO {
      int id_evento PK
      varchar nombre
      boolean requiere_evacuar
    }
    RUTAS {
      int id_ruta PK
      int area_origen FK
      timestamp fecha
      int tiempo_estimado_total
      jsonb ruta
      int id_seguridad FK
    }
    HISTORICO_RUTAS {
      int id PK
      int id_ruta FK
      timestamp datatime
    }

    EDIFICIO ||--|{ PLANTA : "contiene"
    PLANTA ||--|{ AREA : "contiene"
    TIPO_AREA ||--o{ AREA : "es de tipo"
    ADYACENCIA ||--|{ AREA : "interconecta" 
    TIPO_ADYACENCIA ||--o{ ADYACENCIA : "interconecta"

    AREA ||--o{ BALIZAS : "puede contener"
    ADYACENCIA ||--o{ BALIZAS : "puede contener"
    BALIZAS ||--o{ BALIZA_SENSOR : "contiene"
    SENSOR ||--o{ BALIZA_SENSOR : "se conecta a"
    SENSOR ||--o{ SENSOR_VARIABLE : "contiene"
    VARIABLE ||--o{ SENSOR_VARIABLE : "se mide en"

    LECTURA_BALIZA_ADYACENCIAS ||--o{ ADYACENCIA : "tiene"
    LECTURA_BALIZA_ADYACENCIAS ||--o{ BALIZAS : "recoge"
    LECTURA_BALIZA_ADYACENCIAS ||--o{ SENSOR : "usa"
    LECTURA_BALIZA_ADYACENCIAS ||--o{ VARIABLE : "mide"

    LECTURA_BALIZA_AREAS ||--o{ BALIZAS : "tiene"
    LECTURA_BALIZA_AREAS ||--o{ BALIZAS : "recoge"
    LECTURA_BALIZA_AREAS ||--o{ SENSOR : "usa"
    LECTURA_BALIZA_AREAS ||--o{ VARIABLE : "mide"

    LECTURA_BALIZA_AREAS ||--o{ HISTORICO_LECTURAS : "recoge"
    LECTURA_BALIZA_ADYACENCIAS ||--o{ HISTORICO_LECTURAS : "recoge"

    SEGURIDAD_RED ||--|| LECTURA_BALIZA_AREAS : "tiene"
    SEGURIDAD_RED ||--|| LECTURA_BALIZA_ADYACENCIAS : "tiene"
    SEGURIDAD_RED ||--|| AREA : "tiene"
    SEGURIDAD_RED ||--|| ADYACENCIA : "tiene"
    SEGURIDAD_RED }|--|| TIPO_EVENTO : "tiene"

    SEGURIDAD_RED ||--o{ HISTORICO_SEGURIDAD : "recoge"

    RUTAS ||--o{ SEGURIDAD_RED : "tiene"
    RUTAS ||--o{ AREA : "tiene"
    RUTAS ||--o{ HISTORICO_RUTAS : "recoge"