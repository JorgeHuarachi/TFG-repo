---
config:
  theme: default
---
erDiagram
    direction RL
        
    EDIFICIO ||--|{ PLANTA : "contiene"
    PLANTA ||--|{ AREA : "contiene"
    TIPO_AREA ||--o{ AREA : "es de tipo"
    ADYACENCIA ||--|{ AREA : "con origen" 
    ADYACENCIA ||--|{ AREA : "con destino" 
    TIPO_ADYACENCIA ||--o{ ADYACENCIA : "es de tipo"
    
    AREA ||--o{ BALIZA : "ubicada en"
    ADYACENCIA ||--o{ BALIZA : "ubicada en"
    
    BALIZA ||--o{ ASOCIACION_BALIZA_SENSOR : "esta conectado a "
    SENSOR ||--o{ ASOCIACION_BALIZA_SENSOR : "es parte de"
    SENSOR ||--o{ ASOCIACION_SENSOR_VARIABLE : "mide"
    VARIABLE ||--o{ ASOCIACION_SENSOR_VARIABLE : "usado en"

    LECTURA ||--o{ BALIZA : "registra"
    LECTURA ||--o{ SENSOR : "usa"
    LECTURA ||--o{ VARIABLE : "mide"


    ADYACENCIA ||--o{ ASIGNACION_LECTURA_ADYACENCIA : "tiene"
    ASIGNACION_LECTURA_ADYACENCIA ||--o{ LECTURA : "es una"

    AREA ||--o{ LECTURA_BALIZA_AREAS : "tiene"
    LECTURA_BALIZA_AREAS ||--o{ LECTURA : "e"

    LECTURA ||--o{ HISTORICO_LECTURAS : "recoge"

    SEGURIDAD_RED ||--|{ LECTURA_SEGURIDAD : "basada en"
    LECTURA ||--o{ LECTURA_SEGURIDAD : "asocia a seguridad"
    SEGURIDAD_RED }|--|| TIPO_EVENTO : "tiene"

    SEGURIDAD_RED ||--o{ HISTORICO_SEGURIDAD : "recoge"

    RUTA }|--|{ SEGURIDAD_RED : "tiene"
    RUTA ||--o{ AREA : "es origen de"
    RUTA ||--o{ HISTORICO_RUTA : "recoge"

    USUARIO ||--o{ RUTA : "solicita"
    USUARIO ||--o{ USUARIO_UBICACION_ACTUAL : "tiene"
    USUARIO ||--o{ HISTORICO_USUARIO_UBICACION : "tuvo"

    EDIFICIO {
      int id_edificio PK
      varchar nombre
      text descripción
      float latitud
      float longitud
      int capacidad_personas
      float superficie_metros_cuadrados
    }
    PLANTA{
      int id_planta PK
      float superficie_metros_cuadrados
      int id_edificio FK
    }
    AREA {
      int id_area PK
      varchar nombre
      text descripción
      float superficie_metros_cuadrados
      int capacidad_personas
      boolean salida_segura
      int id_planta FK
      int id_tipo_area FK
    }
    TIPO_AREA {
      int id_tipo_area PK
      varchar nombre
      text descripción
    }
    ADYACENCIA {
      int id_adyacencia PK
      varchar nombre
      text descripción
      float distancia_metros
      int capacidad_flujo_personas_minuto
      float tiempo_estimado_segundos
      boolean bidireccional
      int id_area_origen FK
      int id_area_destino FK
      int id_tipo_adyacencia FK
    }
    TIPO_ADYACENCIA {
      int id_tipo_adyacencia PK
      varchar nombre
      text descripción
    }
    BALIZA {
      int id_baliza PK
      varchar nombre
      text descripción
      boolean activa
      int id_area FK
      int id_adyacencia FK
    }
    SENSOR {
      int id_sensor PK 
      varchar nombre
      text descripción
      boolean activa
    }
    VARIABLE {
      int id_variable PK
      varchar nombre
      text descripción
      varchar unidad
    }
    ASOCIACION_BALIZA_SENSOR {
      int id PK
      int id_baliza FK
      int id_sensor FK 
      text descripción
    }
    ASOCIACION_SENSOR_VARIABLE {
      int id PK
      int id_sensor FK
      int id_variable FK
      text descripción
    }
    LECTURA {
      int id_lectura PK
      timestamp datatime
      int id_baliza FK
      int id_sensor FK
      int id_variable FK
      float valor
    }    
    LECTURA_BALIZA_AREAS {
      int id_lectura FK
      int id_area FK
    }
    ASIGNACION_LECTURA_ADYACENCIA {
      int id_lectura FK
      int id_adyacencia FK
    }
    HISTORICO_LECTURAS {
      int id PK
      timestamp datatime
      int id_lectura FK
    }
    LECTURA_SEGURIDAD {
      int id PK
      ind id_lectura FK
      int id_seguridad FK
    }
    SEGURIDAD_RED {
      int id_seguridad PK
      timestamp datetime 
      int id_lectura FK
      int id_evento FK
      float seguridad
      boolean seguro
    }
    HISTORICO_SEGURIDAD {
      int id PK
      timestamp datatime
      int id_seguridad FK
    }
    TIPO_EVENTO {
      int id_evento PK
      varchar nombre
      boolean requiere_evacuar
    }
    USUARIO {
        int id_usuario PK
        varchar nombre
        varchar correo
        timestamp creado_en
    }
    USUARIO_UBICACION_ACTUAL {
        int id PK
        int id_usuario FK
        enum tipo_ubicacion 
        int id_area FK
        int id_adyacencia FK
        timestamp fecha
    }  
    HISTORICO_USUARIO_UBICACION{
        int id PK
        int id_usuario FK
        enum tipo_ubicacion
        int id_area FK
        int id_adyacencia FK
        timestamp detección
    } 
    RUTA {
      int id_ruta PK
      int area_origen FK
      timestamp fecha
      int tiempo_estimado_total
      jsonb ruta
      int id_seguridad FK
      int id_usuario FK
    }
    HISTORICO_RUTA {
      int id PK
      int id_ruta FK
      timestamp datatime
    }

